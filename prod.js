const e="application",t="audio",s="font",l="image",r="message",i="model",n="text",m="video",o={[e]:["andrew-inset","atom+xml","atomcat+xml","atomdeleted+xml","atomsvc+xml","atsc-dwd+xml","atsc-held+xml","atsc-rsat+xml","automationml-aml+xml","automationml-amlx+zip","calendar+xml","ccxml+xml","cdfx+xml","cdmi-capability","cdmi-container","cdmi-domain","cdmi-object","cdmi-queue","cpl+xml","cwl","dash+xml","dash-patch+xml","davmount+xml","dicom","dssc+der","dssc+xml","emma+xml","emotionml+xml","epub+zip","exi","express","fdf","fdt+xml","font-tdpfr","geo+json","gml+xml","gzip","hyperstudio","inkml+xml","ipfix","its+xml","java-archive","json","ld+json","lgr+xml","lost+xml","mac-binhex40","mads+xml","manifest+json","marc","marcxml+xml","mathematica","mathml+xml","mbox","media-policy-dataset+xml","mediaservercontrol+xml","metalink4+xml","mets+xml","mmt-aei+xml","mmt-usd+xml","mods+xml","mp21","mp4","msword","mxf","n-quads","n-triples","node","octet-stream","oda","oebps-package+xml","ogg","oxps","p2p-overlay+xml","patch-ops-error+xml","pdf","pgp-encrypted","pgp-keys","pgp-signature","pkcs10","pkcs7-mime","pkcs7-signature","pkcs8","pkix-attr-cert","pkix-cert","pkix-crl","pkix-pkipath","pkixcmp","pls+xml","postscript","provenance+xml","prs.cww","prs.xsf+xml","pskc+xml","rdf+xml","reginfo+xml","relax-ng-compact-syntax","resource-lists+xml","resource-lists-diff+xml","rls-services+xml","route-apd+xml","route-s-tsid+xml","route-usd+xml","rpki-ghostbusters","rpki-manifest","rpki-roa","rtf","sbml+xml","scvp-cv-request","scvp-cv-response","scvp-vp-request","scvp-vp-response","sdp","senml+xml","sensml+xml","set-payment-initiation","set-registration-initiation","shf+xml","sieve","smil+xml","sparql-query","sparql-results+xml","sql","srgs","srgs+xml","sru+xml","ssml+xml","swid+xml","tei+xml","thraud+xml","timestamped-data","toml","trig","ttml+xml","urc-ressheet+xml","urc-targetdesc+xml","voicexml+xml","wasm","watcherinfo+xml","widget","wsdl+xml","wspolicy+xml","xcap-att+xml","xcap-caps+xml","xcap-diff+xml","xcap-el+xml","xcap-ns+xml","xenc+xml","xfdf","xhtml+xml","xliff+xml","xml","xml-dtd","xop+xml","xslt+xml","xv+xml","yang","yin+xml","zip"],[t]:["3gpp","aac","amr","basic","mobile-xmf","mp4","mpeg","ogg"],[s]:["collection","otf","ttf","woff","woff2"],[l]:["aces","apng","avci","avcs","avif","bmp","cgm","dicom-rle","dpx","emf","fits","g3fax","gif","heic","heic-sequence","heif","heif-sequence","hej2k","ief","jaii","jais","jls","jp2","jpeg","jph","jphc","jpm","jpx","jxl","jxr","jxra","jxrs","jxs","jxsc","jxsi","jxss","ktx","ktx2","png","prs.btif","prs.pti","svg+xml","t38","tiff","tiff-fx","webp","wmf"],[r]:["disposition-notification","global","global-delivery-status","global-disposition-notification","global-headers","rfc822"],[i]:["3mf","gltf+json","gltf-binary","iges","jt","mesh","mtl","obj","prc","step","step+xml","step+zip","step-xml+zip","stl","u3d","vrml","x3d+fastinfoset","x3d+xml","x3d-vrml"],[n]:["cache-manifest","calendar","css","csv","html","javascript","markdown","n3","plain","prs.lines.tag","richtext","sgml","shex","spdx","tab-separated-values","troff","turtle","uri-list","vcard","vtt","wgsl"],[m]:["3gpp","3gpp2","h261","h263","h264","iso.segment","jpeg","mj2","mp2t","mp4","mpeg","ogg","quicktime"]},a=e=>e.startsWith(".")?e.slice(1):e;var c=new Proxy({210:[i,9],ez:[e,0],atom:[e,1],atomcat:[e,2],atomdeleted:[e,3],atomsvc:[e,4],dwd:[e,5],held:[e,6],rsat:[e,7],aml:[e,8],amlx:[e,9],xcs:[e,10],ccxml:[e,11],cdfx:[e,12],cdmia:[e,13],cdmic:[e,14],cdmid:[e,15],cdmio:[e,16],cdmiq:[e,17],cpl:[e,18],cwl:[e,19],mpd:[e,20],mpp:[e,21],davmount:[e,22],dcm:[e,23],dssc:[e,24],xdssc:[e,25],emma:[e,26],emotionml:[e,27],epub:[e,28],exi:[e,29],exp:[e,30],fdf:[e,31],fdt:[e,32],pfr:[e,33],geojson:[e,34],gml:[e,35],gz:[e,36],stk:[e,37],ink:[e,38],inkml:[e,38],ipfix:[e,39],its:[e,40],jar:[e,41],war:[e,41],ear:[e,41],json:[e,42],map:[e,42],jsonld:[e,43],lgr:[e,44],lostxml:[e,45],hqx:[e,46],mads:[e,47],webmanifest:[e,48],mrc:[e,49],mrcx:[e,50],ma:[e,51],nb:[e,51],mb:[e,51],mathml:[e,52],mbox:[e,53],mpf:[e,54],mscml:[e,55],meta4:[e,56],mets:[e,57],maei:[e,58],musd:[e,59],mods:[e,60],m21:[e,61],mp21:[e,61],mp4:[e,62],mpg4:[e,62],mp4s:[e,62],m4p:[e,62],doc:[e,63],dot:[e,63],mxf:[e,64],nq:[e,65],nt:[e,66],cjs:[e,67],bin:[e,68],dms:[e,68],lrf:[e,68],mar:[e,68],so:[e,68],dist:[e,68],distz:[e,68],pkg:[e,68],bpk:[e,68],dump:[e,68],elc:[e,68],deploy:[e,68],exe:[e,68],dll:[e,68],deb:[e,68],dmg:[e,68],iso:[e,68],img:[e,68],msi:[e,68],msp:[e,68],msm:[e,68],buffer:[e,68],oda:[e,69],opf:[e,70],ogx:[e,71],oxps:[e,72],relo:[e,73],xer:[e,74],pdf:[e,75],pgp:[e,76],asc:[e,77],sig:[e,78],p10:[e,79],p7m:[e,80],p7c:[e,80],p7s:[e,81],p8:[e,82],ac:[e,83],cer:[e,84],crl:[e,85],pkipath:[e,86],pki:[e,87],pls:[e,88],ai:[e,89],eps:[e,89],ps:[e,89],provx:[e,90],cww:[e,91],xsf:[e,92],pskcxml:[e,93],rdf:[e,94],owl:[e,94],rif:[e,95],rnc:[e,96],rl:[e,97],rld:[e,98],rs:[e,99],rapd:[e,100],sls:[e,101],rusd:[e,102],gbr:[e,103],mft:[e,104],roa:[e,105],rtf:[e,106],sbml:[e,107],scq:[e,108],scs:[e,109],spq:[e,110],spp:[e,111],sdp:[e,112],senmlx:[e,113],sensmlx:[e,114],setpay:[e,115],setreg:[e,116],shf:[e,117],siv:[e,118],sieve:[e,118],smi:[e,119],smil:[e,119],rq:[e,120],srx:[e,121],sql:[e,122],gram:[e,123],grxml:[e,124],sru:[e,125],ssml:[e,126],swidtag:[e,127],tei:[e,128],teicorpus:[e,128],tfi:[e,129],tsd:[e,130],toml:[e,131],trig:[e,132],ttml:[e,133],rsheet:[e,134],td:[e,135],vxml:[e,136],wasm:[e,137],wif:[e,138],wgt:[e,139],wsdl:[e,140],wspolicy:[e,141],xav:[e,142],xca:[e,143],xdf:[e,144],xel:[e,145],xns:[e,146],xenc:[e,147],xfdf:[e,148],xhtml:[e,149],xht:[e,149],xlf:[e,150],xml:[e,151],xsl:[e,151],xsd:[e,151],rng:[e,151],dtd:[e,152],xop:[e,153],xslt:[e,154],mxml:[e,155],xhvml:[e,155],xvml:[e,155],xvm:[e,155],yang:[e,156],yin:[e,157],zip:[e,158],"3gpp":[t,0],adts:[t,1],aac:[t,1],amr:[t,2],au:[t,3],snd:[t,3],mxmf:[t,4],m4a:[t,5],mp4a:[t,5],m4b:[t,5],mpga:[t,6],mp2:[t,6],mp2a:[t,6],mp3:[t,6],m2a:[t,6],m3a:[t,6],oga:[t,7],ogg:[t,7],spx:[t,7],opus:[t,7],ttc:[s,0],otf:[s,1],ttf:[s,2],woff:[s,3],woff2:[s,4],exr:[l,0],apng:[l,1],avci:[l,2],avcs:[l,3],avif:[l,4],bmp:[l,5],dib:[l,5],cgm:[l,6],drle:[l,7],dpx:[l,8],emf:[l,9],fits:[l,10],g3:[l,11],gif:[l,12],heic:[l,13],heics:[l,14],heif:[l,15],heifs:[l,16],hej2:[l,17],ief:[l,18],jaii:[l,19],jais:[l,20],jls:[l,21],jp2:[l,22],jpg2:[l,22],jpg:[l,23],jpeg:[l,23],jpe:[l,23],jph:[l,24],jhc:[l,25],jpm:[l,26],jpgm:[l,26],jpx:[l,27],jpf:[l,27],jxl:[l,28],jxr:[l,29],jxra:[l,30],jxrs:[l,31],jxs:[l,32],jxsc:[l,33],jxsi:[l,34],jxss:[l,35],ktx:[l,36],ktx2:[l,37],png:[l,38],btif:[l,39],btf:[l,39],pti:[l,40],svg:[l,41],svgz:[l,41],t38:[l,42],tif:[l,43],tiff:[l,43],tfx:[l,44],webp:[l,45],wmf:[l,46],"disposition-notification":[r,0],u8msg:[r,1],u8dsn:[r,2],u8mdn:[r,3],u8hdr:[r,4],eml:[r,5],mime:[r,5],mht:[r,5],mhtml:[r,5],"3mf":[i,0],gltf:[i,1],glb:[i,2],igs:[i,3],iges:[i,3],jt:[i,4],msh:[i,5],mesh:[i,5],silo:[i,5],mtl:[i,6],obj:[i,7],prc:[i,8],step:[i,9],stp:[i,9],stpnc:[i,9],p21:[i,9],stpx:[i,10],stpz:[i,11],stpxz:[i,12],stl:[i,13],u3d:[i,14],wrl:[i,15],vrml:[i,15],x3db:[i,16],x3d:[i,17],x3dz:[i,17],x3dv:[i,18],appcache:[n,0],manifest:[n,0],ics:[n,1],ifb:[n,1],css:[n,2],csv:[n,3],html:[n,4],htm:[n,4],shtml:[n,4],js:[n,5],mjs:[n,5],md:[n,6],markdown:[n,6],n3:[n,7],txt:[n,8],text:[n,8],conf:[n,8],def:[n,8],list:[n,8],log:[n,8],in:[n,8],ini:[n,8],dsc:[n,9],rtx:[n,10],sgml:[n,11],sgm:[n,11],shex:[n,12],spdx:[n,13],tsv:[n,14],t:[n,15],tr:[n,15],roff:[n,15],man:[n,15],me:[n,15],ms:[n,15],ttl:[n,16],uri:[n,17],uris:[n,17],urls:[n,17],vcard:[n,18],vtt:[n,19],wgsl:[n,20],"3gp":[m,0],"3g2":[m,1],h261:[m,2],h263:[m,3],h264:[m,4],m4s:[m,5],jpgv:[m,6],mj2:[m,7],mjp2:[m,7],ts:[m,8],m2t:[m,8],m2ts:[m,8],mts:[m,8],mp4v:[m,9],mpeg:[m,10],mpg:[m,10],mpe:[m,10],m1v:[m,10],m2v:[m,10],ogv:[m,11],qt:[m,12],mov:[m,12]},{has:(e,t)=>e.hasOwnProperty(a(t)),get:(e,t)=>{const s=e[a(t)];return s&&`${s[0]}/${o[s[0]][s[1]]}`}});const{floor:p,log:d,pow:x}=Math,{assign:f,defineProperties:u}=Object,g=(e,t=2)=>{let s=0;if(e){const l=1e3,r=t<0?0:t;s=p(d(e)/d(l)),e=(e/x(l,s)).toFixed(r)}return`${e} ${["bytes","kB","mB","gB","tB","pB","eB","zB","yB"][s]}`},h=(e,t)=>f(document.createElement(e),t),v=(e,t)=>{throw new Error(`Item ${e} already exists in folder ${t.name}`)},w=(e,t)=>{throw new Error(`Item ${e.name} not found in folder ${t.name}`)},b=e=>getComputedStyle(e).height,y=(e,t)=>!!e?.classList?.contains?.(t),j=(e,t)=>e.some(e=>e.name===t),k=e=>{"Enter"===e.key&&e.currentTarget.blur()},q=e=>{const t=[e.querySelector("button").textContent];for(;e=e.parentNode?.closest("li");)t.unshift(e.querySelector("button").textContent);return t.join("/")},S=e=>{e.stopImmediatePropagation()},{at:z,map:E,reduce:C}=Array.prototype,{File:L}=globalThis,$=e=>{const t=e.querySelector("button").textContent.trim();if(y(e,"folder")){const s=new K(t);return s.append(...E.call(e.querySelector("ul").children,$)),s}return new J(["\0".repeat(+e.dataset.bytes||0)],t)},B=(e,t)=>{if(e instanceof K){const s=new K(t);return s.append(...e[D]),s}return new J([e],t,e)},I=(e,t)=>e+1+(y(t,"folder")&&y(t,"opened")?P(t.querySelector("ul")):0),N=e=>{const{name:t,size:s,type:l}=e;let r=R.get(e);return r||(r=h("li",{className:/^text\//.test(l)?"text":"file"}),r.appendChild(h("button",{textContent:t,onfocus:T})).dataset.bytes=g(+s||0),R.set(e,r),W.set(r,e)),r},O=e=>(R.get(e).querySelector("button").focus(),e),P=({children:e})=>C.call(e,I,0),T=({currentTarget:e})=>{G=W.get(e.closest("li"))},A=(e,t)=>{const s=e instanceof K,l=t instanceof K;return s&&!l?-1:!s&&l?1:e.name.localeCompare(t.name)},M=e=>{S(e),H=!1;for(const t of e.currentTarget.closest(":host > ul").querySelectorAll("ul"))t.style.height=y(t.parentElement,"opened")?"auto":"0px"},U=CSS.supports("interpolate-size:allow-keywords"),F=await(async e=>{try{return(await import(e,{with:{type:"css"}})).default}catch{const t=new CSSStyleSheet;return await t.replace(await fetch(e).then(e=>e.text())),t}})(import.meta.url.replace(/(\.)?js(\+.+)?$/,"$1css")),R=new WeakMap,W=new WeakMap,D=Symbol("items");let H=!1,G=null;class J extends L{constructor(e,t,s){const l=(e=>{const t=e.lastIndexOf("."),s=e.slice(t);return{name:t<0?encodeURIComponent(e):encodeURIComponent(e.slice(0,t))+s,type:c[s]??"text/plain"}})(t);N(super([].concat(e),l.name,{type:l.type,...s}))}}class K{[D]=[];#e;#t;constructor(e){this.#e=encodeURIComponent(e),this.#t=h("ul");const t=h("li",{className:"folder"});t.append(h("button",{textContent:e}),this.#t),R.set(this,t),W.set(t,this)}get files(){return this.items}get items(){return this[D].slice(0)}get list(){return this.#t}get name(){return this.#e}get size(){return this[D].reduce((e,t)=>e+t.size,0)}get type(){return"folder"}append(...e){const t=this[D];for(let s of e){if("string"==typeof s)s=s.lastIndexOf(".")<0?new K(s):new J([],s);else if(!(s instanceof K))if(Symbol.iterator in s)this.append(...s);else if(s instanceof L)s instanceof J||(s=new J([s],s.name,s));else if("folder"===s.type){const e=s.items??s.files;s=new K(s.name),e&&s.append(...e)}else s=new J(s.content??[],s.name,s);t.includes(s)||t.push(s),this.#t.appendChild(N(s))}const{length:s}=t;R.get(this).querySelector("button").dataset.items=`${s} item${1===s?"":"s"}`,t.sort(A);for(let{children:e}=this.#t,l=0;l<s;l++){const s=t[l],r=R.get(s);z.call(e,l)!==r&&this.#t.insertBefore(r,z.call(e,l))}return this}remove(...e){const t=this[D];for(const s of e){G===s&&(G=null);const e=t.indexOf(s);e<0&&w(s,this),t.splice(e,1);const l=R.get(s);R.delete(s),W.delete(l),l.remove()}return this}rename(e,t=""){const s=this[D];if(s.includes(e)||w(e,this),t=t.trim()){j(s,t)&&v(t,this);const l=B(e,t);return this.remove(e).append(l),O(l)}{const l=R.get(e),r=l.querySelector("button"),i=()=>{l.classList.toggle("error",j(s,r.textContent.trim()))};return t=r.textContent.trim(),r.addEventListener("click",S),r.addEventListener("keydown",k),r.addEventListener("input",i),r.setAttribute("role","textbox"),r.contentEditable=!0,new Promise(l=>{r.addEventListener("blur",()=>{r.removeEventListener("click",S),r.removeEventListener("keydown",k),r.removeEventListener("input",i),r.removeAttribute("role"),r.contentEditable=!1;const n=r.textContent.trim();if(t===n)l(O(e));else{j(s,n)&&(r.textContent=t,v(n,this));const i=B(e,n);this.remove(e).append(i),l(O(i))}},{once:!0}),r.focus()})}}update(e,t){const s=this[D],l=s.indexOf(e);return l<0&&w(e,this),s[l]=((e,t)=>{const s=R.get(e);return R.delete(e),R.set(t,s),W.set(s,t),s.querySelector("button").dataset.bytes=g(+t.size||0),t})(e,new J(t,item.name,item))}}class Q extends HTMLElement{#s;constructor(e={}){const t=super().querySelector("ul"),s=this.attachShadow({mode:"open"}),{list:l}=this.#s=new K("#root");if(s.adoptedStyleSheets.push(F),t){t.remove();for(const{name:e,value:s}of t.attributes)l.setAttribute(e,s);this.append(...E.call(t.children,$))}l.addEventListener("click",V),s.replaceChildren(l)}get files(){return this.#s.files}get items(){return this.#s.items}get list(){return this.#s.list}get name(){return this.#s.name}get size(){return this.#s.size}get type(){return this.#s.type}get selected(){return G}append(...e){return this.#s.append(...e),this}remove(...e){return this.#s.remove(...e),this}rename(e,t=""){return this.#s.rename(e,t)}update(e,t){return this.#s.update(e,t)}}async function V(e){S(e),e.preventDefault();const t=e.target?.closest("li"),s=t?.querySelector("button");if(!t||s?.disabled||H)return;const l=W.get(t),r=y(t,"folder"),i=r?y(t,"opened")?"close":"open":"click";if(e=((e,t=null)=>u(new CustomEvent("click",{detail:e,bubbles:!0,cancelable:!0}),{waitUntil:{value:(...e)=>{[t]=e}},then:{value:(...e)=>t?.then(...e)},async:{get:()=>!!t}}))({get owner(){const e=t.parentNode.closest("li");return e?W.get(e):t.closest(":host > ul").parentNode.host},originalTarget:t,path:q(t),action:i,folder:r,target:l}),t.closest(":host > ul").parentNode.host.dispatchEvent(e),!e.defaultPrevented){if(e.async){t.classList.add("waiting"),t.classList.remove("error");try{await e}catch{return void t.classList.add("error")}finally{t.classList.remove("waiting")}}if(r){if(!U){H=!0;const e=y(t,"opened"),s=t.querySelector("ul");s.addEventListener("transitionend",M),s.animate([{height:e?b(s):0},{height:e?0:parseFloat(b(t))*P(s)+"px"}],{iterations:1,duration:200,easing:"ease"})}t.classList.toggle("opened")}s!==document.activeElement&&s.focus()}}customElements.define("file-tree",Q);export{J as File,K as Folder,Q as Tree};
