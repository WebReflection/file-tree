const e="application",t="audio",s="font",r="image",n="message",l="model",i="text",m="video",o={[e]:["andrew-inset","atom+xml","atomcat+xml","atomdeleted+xml","atomsvc+xml","atsc-dwd+xml","atsc-held+xml","atsc-rsat+xml","automationml-aml+xml","automationml-amlx+zip","calendar+xml","ccxml+xml","cdfx+xml","cdmi-capability","cdmi-container","cdmi-domain","cdmi-object","cdmi-queue","cpl+xml","cwl","dash+xml","dash-patch+xml","davmount+xml","dicom","dssc+der","dssc+xml","emma+xml","emotionml+xml","epub+zip","exi","express","fdf","fdt+xml","font-tdpfr","geo+json","gml+xml","gzip","hyperstudio","inkml+xml","ipfix","its+xml","java-archive","json","ld+json","lgr+xml","lost+xml","mac-binhex40","mads+xml","manifest+json","marc","marcxml+xml","mathematica","mathml+xml","mbox","media-policy-dataset+xml","mediaservercontrol+xml","metalink4+xml","mets+xml","mmt-aei+xml","mmt-usd+xml","mods+xml","mp21","mp4","msword","mxf","n-quads","n-triples","node","octet-stream","oda","oebps-package+xml","ogg","oxps","p2p-overlay+xml","patch-ops-error+xml","pdf","pgp-encrypted","pgp-keys","pgp-signature","pkcs10","pkcs7-mime","pkcs7-signature","pkcs8","pkix-attr-cert","pkix-cert","pkix-crl","pkix-pkipath","pkixcmp","pls+xml","postscript","provenance+xml","prs.cww","prs.xsf+xml","pskc+xml","rdf+xml","reginfo+xml","relax-ng-compact-syntax","resource-lists+xml","resource-lists-diff+xml","rls-services+xml","route-apd+xml","route-s-tsid+xml","route-usd+xml","rpki-ghostbusters","rpki-manifest","rpki-roa","rtf","sbml+xml","scvp-cv-request","scvp-cv-response","scvp-vp-request","scvp-vp-response","sdp","senml+xml","sensml+xml","set-payment-initiation","set-registration-initiation","shf+xml","sieve","smil+xml","sparql-query","sparql-results+xml","sql","srgs","srgs+xml","sru+xml","ssml+xml","swid+xml","tei+xml","thraud+xml","timestamped-data","toml","trig","ttml+xml","urc-ressheet+xml","urc-targetdesc+xml","voicexml+xml","wasm","watcherinfo+xml","widget","wsdl+xml","wspolicy+xml","xcap-att+xml","xcap-caps+xml","xcap-diff+xml","xcap-el+xml","xcap-ns+xml","xenc+xml","xfdf","xhtml+xml","xliff+xml","xml","xml-dtd","xop+xml","xslt+xml","xv+xml","yang","yin+xml","zip"],[t]:["3gpp","aac","amr","basic","mobile-xmf","mp4","mpeg","ogg"],[s]:["collection","otf","ttf","woff","woff2"],[r]:["aces","apng","avci","avcs","avif","bmp","cgm","dicom-rle","dpx","emf","fits","g3fax","gif","heic","heic-sequence","heif","heif-sequence","hej2k","ief","jaii","jais","jls","jp2","jpeg","jph","jphc","jpm","jpx","jxl","jxr","jxra","jxrs","jxs","jxsc","jxsi","jxss","ktx","ktx2","png","prs.btif","prs.pti","svg+xml","t38","tiff","tiff-fx","webp","wmf"],[n]:["disposition-notification","global","global-delivery-status","global-disposition-notification","global-headers","rfc822"],[l]:["3mf","gltf+json","gltf-binary","iges","jt","mesh","mtl","obj","prc","step","step+xml","step+zip","step-xml+zip","stl","u3d","vrml","x3d+fastinfoset","x3d+xml","x3d-vrml"],[i]:["cache-manifest","calendar","css","csv","html","javascript","markdown","n3","plain","prs.lines.tag","richtext","sgml","shex","spdx","tab-separated-values","troff","turtle","uri-list","vcard","vtt","wgsl"],[m]:["3gpp","3gpp2","h261","h263","h264","iso.segment","jpeg","mj2","mp2t","mp4","mpeg","ogg","quicktime"]},a=e=>e.startsWith(".")?e.slice(1):e;var c=new Proxy({210:[l,9],ez:[e,0],atom:[e,1],atomcat:[e,2],atomdeleted:[e,3],atomsvc:[e,4],dwd:[e,5],held:[e,6],rsat:[e,7],aml:[e,8],amlx:[e,9],xcs:[e,10],ccxml:[e,11],cdfx:[e,12],cdmia:[e,13],cdmic:[e,14],cdmid:[e,15],cdmio:[e,16],cdmiq:[e,17],cpl:[e,18],cwl:[e,19],mpd:[e,20],mpp:[e,21],davmount:[e,22],dcm:[e,23],dssc:[e,24],xdssc:[e,25],emma:[e,26],emotionml:[e,27],epub:[e,28],exi:[e,29],exp:[e,30],fdf:[e,31],fdt:[e,32],pfr:[e,33],geojson:[e,34],gml:[e,35],gz:[e,36],stk:[e,37],ink:[e,38],inkml:[e,38],ipfix:[e,39],its:[e,40],jar:[e,41],war:[e,41],ear:[e,41],json:[e,42],map:[e,42],jsonld:[e,43],lgr:[e,44],lostxml:[e,45],hqx:[e,46],mads:[e,47],webmanifest:[e,48],mrc:[e,49],mrcx:[e,50],ma:[e,51],nb:[e,51],mb:[e,51],mathml:[e,52],mbox:[e,53],mpf:[e,54],mscml:[e,55],meta4:[e,56],mets:[e,57],maei:[e,58],musd:[e,59],mods:[e,60],m21:[e,61],mp21:[e,61],mp4:[e,62],mpg4:[e,62],mp4s:[e,62],m4p:[e,62],doc:[e,63],dot:[e,63],mxf:[e,64],nq:[e,65],nt:[e,66],cjs:[e,67],bin:[e,68],dms:[e,68],lrf:[e,68],mar:[e,68],so:[e,68],dist:[e,68],distz:[e,68],pkg:[e,68],bpk:[e,68],dump:[e,68],elc:[e,68],deploy:[e,68],exe:[e,68],dll:[e,68],deb:[e,68],dmg:[e,68],iso:[e,68],img:[e,68],msi:[e,68],msp:[e,68],msm:[e,68],buffer:[e,68],oda:[e,69],opf:[e,70],ogx:[e,71],oxps:[e,72],relo:[e,73],xer:[e,74],pdf:[e,75],pgp:[e,76],asc:[e,77],sig:[e,78],p10:[e,79],p7m:[e,80],p7c:[e,80],p7s:[e,81],p8:[e,82],ac:[e,83],cer:[e,84],crl:[e,85],pkipath:[e,86],pki:[e,87],pls:[e,88],ai:[e,89],eps:[e,89],ps:[e,89],provx:[e,90],cww:[e,91],xsf:[e,92],pskcxml:[e,93],rdf:[e,94],owl:[e,94],rif:[e,95],rnc:[e,96],rl:[e,97],rld:[e,98],rs:[e,99],rapd:[e,100],sls:[e,101],rusd:[e,102],gbr:[e,103],mft:[e,104],roa:[e,105],rtf:[e,106],sbml:[e,107],scq:[e,108],scs:[e,109],spq:[e,110],spp:[e,111],sdp:[e,112],senmlx:[e,113],sensmlx:[e,114],setpay:[e,115],setreg:[e,116],shf:[e,117],siv:[e,118],sieve:[e,118],smi:[e,119],smil:[e,119],rq:[e,120],srx:[e,121],sql:[e,122],gram:[e,123],grxml:[e,124],sru:[e,125],ssml:[e,126],swidtag:[e,127],tei:[e,128],teicorpus:[e,128],tfi:[e,129],tsd:[e,130],toml:[e,131],trig:[e,132],ttml:[e,133],rsheet:[e,134],td:[e,135],vxml:[e,136],wasm:[e,137],wif:[e,138],wgt:[e,139],wsdl:[e,140],wspolicy:[e,141],xav:[e,142],xca:[e,143],xdf:[e,144],xel:[e,145],xns:[e,146],xenc:[e,147],xfdf:[e,148],xhtml:[e,149],xht:[e,149],xlf:[e,150],xml:[e,151],xsl:[e,151],xsd:[e,151],rng:[e,151],dtd:[e,152],xop:[e,153],xslt:[e,154],mxml:[e,155],xhvml:[e,155],xvml:[e,155],xvm:[e,155],yang:[e,156],yin:[e,157],zip:[e,158],"3gpp":[t,0],adts:[t,1],aac:[t,1],amr:[t,2],au:[t,3],snd:[t,3],mxmf:[t,4],m4a:[t,5],mp4a:[t,5],m4b:[t,5],mpga:[t,6],mp2:[t,6],mp2a:[t,6],mp3:[t,6],m2a:[t,6],m3a:[t,6],oga:[t,7],ogg:[t,7],spx:[t,7],opus:[t,7],ttc:[s,0],otf:[s,1],ttf:[s,2],woff:[s,3],woff2:[s,4],exr:[r,0],apng:[r,1],avci:[r,2],avcs:[r,3],avif:[r,4],bmp:[r,5],dib:[r,5],cgm:[r,6],drle:[r,7],dpx:[r,8],emf:[r,9],fits:[r,10],g3:[r,11],gif:[r,12],heic:[r,13],heics:[r,14],heif:[r,15],heifs:[r,16],hej2:[r,17],ief:[r,18],jaii:[r,19],jais:[r,20],jls:[r,21],jp2:[r,22],jpg2:[r,22],jpg:[r,23],jpeg:[r,23],jpe:[r,23],jph:[r,24],jhc:[r,25],jpm:[r,26],jpgm:[r,26],jpx:[r,27],jpf:[r,27],jxl:[r,28],jxr:[r,29],jxra:[r,30],jxrs:[r,31],jxs:[r,32],jxsc:[r,33],jxsi:[r,34],jxss:[r,35],ktx:[r,36],ktx2:[r,37],png:[r,38],btif:[r,39],btf:[r,39],pti:[r,40],svg:[r,41],svgz:[r,41],t38:[r,42],tif:[r,43],tiff:[r,43],tfx:[r,44],webp:[r,45],wmf:[r,46],"disposition-notification":[n,0],u8msg:[n,1],u8dsn:[n,2],u8mdn:[n,3],u8hdr:[n,4],eml:[n,5],mime:[n,5],mht:[n,5],mhtml:[n,5],"3mf":[l,0],gltf:[l,1],glb:[l,2],igs:[l,3],iges:[l,3],jt:[l,4],msh:[l,5],mesh:[l,5],silo:[l,5],mtl:[l,6],obj:[l,7],prc:[l,8],step:[l,9],stp:[l,9],stpnc:[l,9],p21:[l,9],stpx:[l,10],stpz:[l,11],stpxz:[l,12],stl:[l,13],u3d:[l,14],wrl:[l,15],vrml:[l,15],x3db:[l,16],x3d:[l,17],x3dz:[l,17],x3dv:[l,18],appcache:[i,0],manifest:[i,0],ics:[i,1],ifb:[i,1],css:[i,2],csv:[i,3],html:[i,4],htm:[i,4],shtml:[i,4],js:[i,5],mjs:[i,5],md:[i,6],markdown:[i,6],n3:[i,7],txt:[i,8],text:[i,8],conf:[i,8],def:[i,8],list:[i,8],log:[i,8],in:[i,8],ini:[i,8],dsc:[i,9],rtx:[i,10],sgml:[i,11],sgm:[i,11],shex:[i,12],spdx:[i,13],tsv:[i,14],t:[i,15],tr:[i,15],roff:[i,15],man:[i,15],me:[i,15],ms:[i,15],ttl:[i,16],uri:[i,17],uris:[i,17],urls:[i,17],vcard:[i,18],vtt:[i,19],wgsl:[i,20],"3gp":[m,0],"3g2":[m,1],h261:[m,2],h263:[m,3],h264:[m,4],m4s:[m,5],jpgv:[m,6],mj2:[m,7],mjp2:[m,7],ts:[m,8],m2t:[m,8],m2ts:[m,8],mts:[m,8],mp4v:[m,9],mpeg:[m,10],mpg:[m,10],mpe:[m,10],m1v:[m,10],m2v:[m,10],ogv:[m,11],qt:[m,12],mov:[m,12]},{has:(e,t)=>e.hasOwnProperty(a(t)),get:(e,t)=>{const s=e[a(t)];return s&&`${s[0]}/${o[s[0]][s[1]]}`}});const{floor:p,log:d,pow:x}=Math,{assign:f,defineProperties:u}=Object,g=(e,t=2)=>{let s=0;if(e){const r=1e3,n=t<0?0:t;s=p(d(e)/d(r)),e=(e/x(r,s)).toFixed(n)}return`${e} ${["bytes","kB","mB","gB","tB","pB","eB","zB","yB"][s]}`},h=(e,t)=>f(document.createElement(e),t),v=(e,t,s=null)=>u(new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0}),{waitUntil:{value:(...e)=>{[s]=e}},then:{value:(...e)=>s?.then(...e)},async:{get:()=>!!s}}),w=(e,t)=>{throw new Error(`Item ${e} already exists in folder ${t.name}`)},b=(e,t)=>{throw new Error(`Item ${e.name} not found in folder ${t.name}`)},y=e=>getComputedStyle(e).height,j=(e,t)=>!!e?.classList?.contains?.(t),k=(e,t)=>e.some(e=>e.name===t),q=e=>{"Enter"===e.key&&e.currentTarget.blur()},S=e=>{const t=[e.querySelector("button").textContent];for(;e=e.parentNode?.closest("li");)t.unshift(e.querySelector("button").textContent);return t.join("/")},E=e=>{e.stopImmediatePropagation()},{at:z,map:C,reduce:L}=Array.prototype,{File:$}=globalThis,B=e=>{E(e);const{type:t}=e,s=e.target?.closest("li"),r=s?.querySelector("button");if(!s||r?.disabled||J)return;const n=H.get(s),l=j(s,"folder"),i="click"===t&&l?j(s,"opened")?"close":"open":t;return[s.closest(":host > ul").parentNode.host,s,r,l,v(t,{get owner(){const e=s.parentNode.closest("li");return e?H.get(e):s.closest(":host > ul").parentNode.host},originalTarget:s,path:S(s),action:i,folder:l,target:n})]},I=e=>{const t=e.querySelector("button").textContent.trim();if(j(e,"folder")){const s=new V(t);return s.append(...C.call(e.querySelector("ul").children,I)),s}return new Q(["\0".repeat(+e.dataset.bytes||0)],t)},N=(e,t)=>{if(e instanceof V){const s=new V(t);return s.append(...e[G]),s}return new Q([e],t,e)},O=(e,t)=>e+1+(j(t,"folder")&&j(t,"opened")?A(t.querySelector("ul")):0),P=e=>{const{name:t,size:s,type:r}=e;let n=W.get(e);return n||(n=h("li",{className:/^text\//.test(r)?"text":"file"}),n.appendChild(h("button",{textContent:t,onfocus:M})).dataset.bytes=g(+s||0),W.set(e,n),H.set(n,e)),n},T=e=>(W.get(e).querySelector("button").focus(),e),A=({children:e})=>L.call(e,O,0),M=({currentTarget:e})=>{K=H.get(e.closest("li"))},U=(e,t)=>{const s=e instanceof V,r=t instanceof V;return s&&!r?-1:!s&&r?1:e.name.localeCompare(t.name)},D=e=>{E(e),J=!1;for(const t of e.currentTarget.closest(":host > ul").querySelectorAll("ul"))t.style.height=j(t.parentElement,"opened")?"auto":"0px"},F=CSS.supports("interpolate-size:allow-keywords"),R=await(async e=>{try{return(await import(e,{with:{type:"css"}})).default}catch{const t=new CSSStyleSheet;return await t.replace(await fetch(e).then(e=>e.text())),t}})(import.meta.url.replace(/(\.)?js(\+.+)?$/,"$1css")),W=new WeakMap,H=new WeakMap,G=Symbol("items");let J=!1,K=null;class Q extends ${constructor(e,t,s){const r=(e=>{const t=e.lastIndexOf("."),s=e.slice(t);return{name:t<0?encodeURIComponent(e):encodeURIComponent(e.slice(0,t))+s,type:c[s]??"text/plain"}})(t);P(super([].concat(e),r.name,{type:r.type,...s}))}}class V{[G]=[];#e;#t;constructor(e){this.#e=encodeURIComponent(e),this.#t=h("ul");const t=h("li",{className:"folder"});t.append(h("button",{textContent:e}),this.#t),W.set(this,t),H.set(t,this)}get files(){return this.items}get items(){return this[G].slice(0)}get list(){return this.#t}get name(){return this.#e}get size(){return this[G].reduce((e,t)=>e+t.size,0)}get type(){return"folder"}append(...e){const t=this[G];for(let s of e){if("string"==typeof s)s=s.lastIndexOf(".")<0?new V(s):new Q([],s);else if(!(s instanceof V))if(Symbol.iterator in s)this.append(...s);else if(s instanceof $)s instanceof Q||(s=new Q([s],s.name,s));else if("folder"===s.type){const e=s.items??s.files;s=new V(s.name),e&&s.append(...e)}else s=new Q(s.content??[],s.name,s);t.includes(s)||t.push(s),this.#t.appendChild(P(s))}const{length:s}=t;W.get(this).querySelector("button").dataset.items=`${s} item${1===s?"":"s"}`,t.sort(U);for(let{children:e}=this.#t,r=0;r<s;r++){const s=t[r],n=W.get(s);z.call(e,r)!==n&&this.#t.insertBefore(n,z.call(e,r))}return this}remove(...e){const t=this[G];for(const s of e){K===s&&(K=null);const e=t.indexOf(s);e<0&&b(s,this),t.splice(e,1);const r=W.get(s);W.delete(s),H.delete(r),r.remove()}return this}rename(e,t=""){const s=this[G];if(s.includes(e)||b(e,this),t=t.trim()){k(s,t)&&w(t,this);const r=N(e,t);return this.remove(e).append(r),T(r)}{const r=W.get(e),n=r.querySelector("button"),l=()=>{r.classList.toggle("error",k(s,n.textContent.trim()))};return t=n.textContent.trim(),n.addEventListener("click",E),n.addEventListener("keydown",q),n.addEventListener("input",l),n.setAttribute("role","textbox"),n.contentEditable=!0,new Promise(r=>{n.addEventListener("blur",()=>{n.removeEventListener("click",E),n.removeEventListener("keydown",q),n.removeEventListener("input",l),n.removeAttribute("role"),n.contentEditable=!1;const i=n.textContent.trim();if(t===i)r(T(e));else{k(s,i)&&(n.textContent=t,w(i,this));const l=N(e,i);this.remove(e).append(l),r(T(l))}},{once:!0}),n.focus()})}}update(e,t){const s=this[G],r=s.indexOf(e);return r<0&&b(e,this),s[r]=((e,t)=>{const s=W.get(e);return W.delete(e),W.set(t,s),H.set(s,t),s.querySelector("button").dataset.bytes=g(+t.size||0),t})(e,new Q(t,item.name,item))}}class X extends HTMLElement{#s;constructor(e={}){const t=super().querySelector("ul"),s=this.attachShadow({mode:"open"}),{list:r}=this.#s=new V("#root");if(s.adoptedStyleSheets.push(R),t){t.remove();for(const{name:e,value:s}of t.attributes)r.setAttribute(e,s);this.append(...C.call(t.children,I))}r.addEventListener("click",Y),r.addEventListener("contextmenu",Z),s.replaceChildren(r)}get files(){return this.#s.files}get items(){return this.#s.items}get list(){return this.#s.list}get name(){return this.#s.name}get size(){return this.#s.size}get type(){return this.#s.type}get selected(){return K}append(...e){return this.#s.append(...e),this}remove(...e){return this.#s.remove(...e),this}rename(e,t=""){return this.#s.rename(e,t)}update(e,t){return this.#s.update(e,t)}}async function Y(e){e.preventDefault();const t=B(e);if(!t)return;const[s,r,n,l,i]=t;if(s.dispatchEvent(i),!i.defaultPrevented){if(i.async){r.classList.add("waiting"),r.classList.remove("error");try{await i}catch{return void r.classList.add("error")}finally{r.classList.remove("waiting")}}if(l){if(!F){J=!0;const e=j(r,"opened"),t=r.querySelector("ul");t.addEventListener("transitionend",D),t.animate([{height:e?y(t):0},{height:e?0:parseFloat(y(r))*A(t)+"px"}],{iterations:1,duration:200,easing:"ease"})}r.classList.toggle("opened")}n!==document.activeElement&&n.focus()}}function Z(e){const t=B(e);t&&t[0].dispatchEvent(u(t.pop(),{preventDefault:{value:()=>e.preventDefault()}}))}customElements.define("file-tree",X);export{Q as File,V as Folder,X as Tree};
