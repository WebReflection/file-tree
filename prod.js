const t="application",e="audio",s="font",n="image",i="message",r="model",l="text",o="video",m={[t]:["andrew-inset","atom+xml","atomcat+xml","atomdeleted+xml","atomsvc+xml","atsc-dwd+xml","atsc-held+xml","atsc-rsat+xml","automationml-aml+xml","automationml-amlx+zip","calendar+xml","ccxml+xml","cdfx+xml","cdmi-capability","cdmi-container","cdmi-domain","cdmi-object","cdmi-queue","cpl+xml","cwl","dash+xml","dash-patch+xml","davmount+xml","dicom","dssc+der","dssc+xml","emma+xml","emotionml+xml","epub+zip","exi","express","fdf","fdt+xml","font-tdpfr","geo+json","gml+xml","gzip","hyperstudio","inkml+xml","ipfix","its+xml","java-archive","json","ld+json","lgr+xml","lost+xml","mac-binhex40","mads+xml","manifest+json","marc","marcxml+xml","mathematica","mathml+xml","mbox","media-policy-dataset+xml","mediaservercontrol+xml","metalink4+xml","mets+xml","mmt-aei+xml","mmt-usd+xml","mods+xml","mp21","mp4","msword","mxf","n-quads","n-triples","node","octet-stream","oda","oebps-package+xml","ogg","oxps","p2p-overlay+xml","patch-ops-error+xml","pdf","pgp-encrypted","pgp-keys","pgp-signature","pkcs10","pkcs7-mime","pkcs7-signature","pkcs8","pkix-attr-cert","pkix-cert","pkix-crl","pkix-pkipath","pkixcmp","pls+xml","postscript","provenance+xml","prs.cww","prs.xsf+xml","pskc+xml","rdf+xml","reginfo+xml","relax-ng-compact-syntax","resource-lists+xml","resource-lists-diff+xml","rls-services+xml","route-apd+xml","route-s-tsid+xml","route-usd+xml","rpki-ghostbusters","rpki-manifest","rpki-roa","rtf","sbml+xml","scvp-cv-request","scvp-cv-response","scvp-vp-request","scvp-vp-response","sdp","senml+xml","sensml+xml","set-payment-initiation","set-registration-initiation","shf+xml","sieve","smil+xml","sparql-query","sparql-results+xml","sql","srgs","srgs+xml","sru+xml","ssml+xml","swid+xml","tei+xml","thraud+xml","timestamped-data","toml","trig","ttml+xml","urc-ressheet+xml","urc-targetdesc+xml","voicexml+xml","wasm","watcherinfo+xml","widget","wsdl+xml","wspolicy+xml","xcap-att+xml","xcap-caps+xml","xcap-diff+xml","xcap-el+xml","xcap-ns+xml","xenc+xml","xfdf","xhtml+xml","xliff+xml","xml","xml-dtd","xop+xml","xslt+xml","xv+xml","yang","yin+xml","zip"],[e]:["3gpp","aac","amr","basic","mobile-xmf","mp4","mpeg","ogg"],[s]:["collection","otf","ttf","woff","woff2"],[n]:["aces","apng","avci","avcs","avif","bmp","cgm","dicom-rle","dpx","emf","fits","g3fax","gif","heic","heic-sequence","heif","heif-sequence","hej2k","ief","jaii","jais","jls","jp2","jpeg","jph","jphc","jpm","jpx","jxl","jxr","jxra","jxrs","jxs","jxsc","jxsi","jxss","ktx","ktx2","png","prs.btif","prs.pti","svg+xml","t38","tiff","tiff-fx","webp","wmf"],[i]:["disposition-notification","global","global-delivery-status","global-disposition-notification","global-headers","rfc822"],[r]:["3mf","gltf+json","gltf-binary","iges","jt","mesh","mtl","obj","prc","step","step+xml","step+zip","step-xml+zip","stl","u3d","vrml","x3d+fastinfoset","x3d+xml","x3d-vrml"],[l]:["cache-manifest","calendar","css","csv","html","javascript","markdown","n3","plain","prs.lines.tag","richtext","sgml","shex","spdx","tab-separated-values","troff","turtle","uri-list","vcard","vtt","wgsl"],[o]:["3gpp","3gpp2","h261","h263","h264","iso.segment","jpeg","mj2","mp2t","mp4","mpeg","ogg","quicktime"]},a=t=>t.startsWith(".")?t.slice(1):t;var c=new Proxy({210:[r,9],ez:[t,0],atom:[t,1],atomcat:[t,2],atomdeleted:[t,3],atomsvc:[t,4],dwd:[t,5],held:[t,6],rsat:[t,7],aml:[t,8],amlx:[t,9],xcs:[t,10],ccxml:[t,11],cdfx:[t,12],cdmia:[t,13],cdmic:[t,14],cdmid:[t,15],cdmio:[t,16],cdmiq:[t,17],cpl:[t,18],cwl:[t,19],mpd:[t,20],mpp:[t,21],davmount:[t,22],dcm:[t,23],dssc:[t,24],xdssc:[t,25],emma:[t,26],emotionml:[t,27],epub:[t,28],exi:[t,29],exp:[t,30],fdf:[t,31],fdt:[t,32],pfr:[t,33],geojson:[t,34],gml:[t,35],gz:[t,36],stk:[t,37],ink:[t,38],inkml:[t,38],ipfix:[t,39],its:[t,40],jar:[t,41],war:[t,41],ear:[t,41],json:[t,42],map:[t,42],jsonld:[t,43],lgr:[t,44],lostxml:[t,45],hqx:[t,46],mads:[t,47],webmanifest:[t,48],mrc:[t,49],mrcx:[t,50],ma:[t,51],nb:[t,51],mb:[t,51],mathml:[t,52],mbox:[t,53],mpf:[t,54],mscml:[t,55],meta4:[t,56],mets:[t,57],maei:[t,58],musd:[t,59],mods:[t,60],m21:[t,61],mp21:[t,61],mp4:[t,62],mpg4:[t,62],mp4s:[t,62],m4p:[t,62],doc:[t,63],dot:[t,63],mxf:[t,64],nq:[t,65],nt:[t,66],cjs:[t,67],bin:[t,68],dms:[t,68],lrf:[t,68],mar:[t,68],so:[t,68],dist:[t,68],distz:[t,68],pkg:[t,68],bpk:[t,68],dump:[t,68],elc:[t,68],deploy:[t,68],exe:[t,68],dll:[t,68],deb:[t,68],dmg:[t,68],iso:[t,68],img:[t,68],msi:[t,68],msp:[t,68],msm:[t,68],buffer:[t,68],oda:[t,69],opf:[t,70],ogx:[t,71],oxps:[t,72],relo:[t,73],xer:[t,74],pdf:[t,75],pgp:[t,76],asc:[t,77],sig:[t,78],p10:[t,79],p7m:[t,80],p7c:[t,80],p7s:[t,81],p8:[t,82],ac:[t,83],cer:[t,84],crl:[t,85],pkipath:[t,86],pki:[t,87],pls:[t,88],ai:[t,89],eps:[t,89],ps:[t,89],provx:[t,90],cww:[t,91],xsf:[t,92],pskcxml:[t,93],rdf:[t,94],owl:[t,94],rif:[t,95],rnc:[t,96],rl:[t,97],rld:[t,98],rs:[t,99],rapd:[t,100],sls:[t,101],rusd:[t,102],gbr:[t,103],mft:[t,104],roa:[t,105],rtf:[t,106],sbml:[t,107],scq:[t,108],scs:[t,109],spq:[t,110],spp:[t,111],sdp:[t,112],senmlx:[t,113],sensmlx:[t,114],setpay:[t,115],setreg:[t,116],shf:[t,117],siv:[t,118],sieve:[t,118],smi:[t,119],smil:[t,119],rq:[t,120],srx:[t,121],sql:[t,122],gram:[t,123],grxml:[t,124],sru:[t,125],ssml:[t,126],swidtag:[t,127],tei:[t,128],teicorpus:[t,128],tfi:[t,129],tsd:[t,130],toml:[t,131],trig:[t,132],ttml:[t,133],rsheet:[t,134],td:[t,135],vxml:[t,136],wasm:[t,137],wif:[t,138],wgt:[t,139],wsdl:[t,140],wspolicy:[t,141],xav:[t,142],xca:[t,143],xdf:[t,144],xel:[t,145],xns:[t,146],xenc:[t,147],xfdf:[t,148],xhtml:[t,149],xht:[t,149],xlf:[t,150],xml:[t,151],xsl:[t,151],xsd:[t,151],rng:[t,151],dtd:[t,152],xop:[t,153],xslt:[t,154],mxml:[t,155],xhvml:[t,155],xvml:[t,155],xvm:[t,155],yang:[t,156],yin:[t,157],zip:[t,158],"3gpp":[e,0],adts:[e,1],aac:[e,1],amr:[e,2],au:[e,3],snd:[e,3],mxmf:[e,4],m4a:[e,5],mp4a:[e,5],m4b:[e,5],mpga:[e,6],mp2:[e,6],mp2a:[e,6],mp3:[e,6],m2a:[e,6],m3a:[e,6],oga:[e,7],ogg:[e,7],spx:[e,7],opus:[e,7],ttc:[s,0],otf:[s,1],ttf:[s,2],woff:[s,3],woff2:[s,4],exr:[n,0],apng:[n,1],avci:[n,2],avcs:[n,3],avif:[n,4],bmp:[n,5],dib:[n,5],cgm:[n,6],drle:[n,7],dpx:[n,8],emf:[n,9],fits:[n,10],g3:[n,11],gif:[n,12],heic:[n,13],heics:[n,14],heif:[n,15],heifs:[n,16],hej2:[n,17],ief:[n,18],jaii:[n,19],jais:[n,20],jls:[n,21],jp2:[n,22],jpg2:[n,22],jpg:[n,23],jpeg:[n,23],jpe:[n,23],jph:[n,24],jhc:[n,25],jpm:[n,26],jpgm:[n,26],jpx:[n,27],jpf:[n,27],jxl:[n,28],jxr:[n,29],jxra:[n,30],jxrs:[n,31],jxs:[n,32],jxsc:[n,33],jxsi:[n,34],jxss:[n,35],ktx:[n,36],ktx2:[n,37],png:[n,38],btif:[n,39],btf:[n,39],pti:[n,40],svg:[n,41],svgz:[n,41],t38:[n,42],tif:[n,43],tiff:[n,43],tfx:[n,44],webp:[n,45],wmf:[n,46],"disposition-notification":[i,0],u8msg:[i,1],u8dsn:[i,2],u8mdn:[i,3],u8hdr:[i,4],eml:[i,5],mime:[i,5],mht:[i,5],mhtml:[i,5],"3mf":[r,0],gltf:[r,1],glb:[r,2],igs:[r,3],iges:[r,3],jt:[r,4],msh:[r,5],mesh:[r,5],silo:[r,5],mtl:[r,6],obj:[r,7],prc:[r,8],step:[r,9],stp:[r,9],stpnc:[r,9],p21:[r,9],stpx:[r,10],stpz:[r,11],stpxz:[r,12],stl:[r,13],u3d:[r,14],wrl:[r,15],vrml:[r,15],x3db:[r,16],x3d:[r,17],x3dz:[r,17],x3dv:[r,18],appcache:[l,0],manifest:[l,0],ics:[l,1],ifb:[l,1],css:[l,2],csv:[l,3],html:[l,4],htm:[l,4],shtml:[l,4],js:[l,5],mjs:[l,5],md:[l,6],markdown:[l,6],n3:[l,7],txt:[l,8],text:[l,8],conf:[l,8],def:[l,8],list:[l,8],log:[l,8],in:[l,8],ini:[l,8],dsc:[l,9],rtx:[l,10],sgml:[l,11],sgm:[l,11],shex:[l,12],spdx:[l,13],tsv:[l,14],t:[l,15],tr:[l,15],roff:[l,15],man:[l,15],me:[l,15],ms:[l,15],ttl:[l,16],uri:[l,17],uris:[l,17],urls:[l,17],vcard:[l,18],vtt:[l,19],wgsl:[l,20],"3gp":[o,0],"3g2":[o,1],h261:[o,2],h263:[o,3],h264:[o,4],m4s:[o,5],jpgv:[o,6],mj2:[o,7],mjp2:[o,7],ts:[o,8],m2t:[o,8],m2ts:[o,8],mts:[o,8],mp4v:[o,9],mpeg:[o,10],mpg:[o,10],mpe:[o,10],m1v:[o,10],m2v:[o,10],ogv:[o,11],qt:[o,12],mov:[o,12]},{has:(t,e)=>t.hasOwnProperty(a(e)),get:(t,e)=>{const s=t[a(e)];return s&&`${s[0]}/${m[s[0]][s[1]]}`}});const{floor:p,log:d,pow:x}=Math,{assign:f,defineProperties:u}=Object,g=(t,e=2)=>{let s=0;if(t){const n=1e3,i=e<0?0:e;s=p(d(t)/d(n)),t=(t/x(n,s)).toFixed(i)}return`${t} ${["bytes","kB","mB","gB","tB","pB","eB","zB","yB"][s]}`},h=(t,e)=>f(document.createElement(t),e),v=(t,e,s=null)=>u(new CustomEvent(t,{detail:e,bubbles:!0,cancelable:!0}),{waitUntil:{value:(...t)=>{[s]=t}},then:{value:(...t)=>s?.then(...t)},async:{get:()=>!!s}}),w=(t,e)=>{throw new Error(`Item ${t} already exists in folder ${e.name}`)},y=(t,e)=>{throw new Error(`Item ${t.name} not found in folder ${e.name}`)},b=t=>getComputedStyle(t).height,j=(t,e)=>!!t?.classList?.contains?.(e),k=(t,e)=>t.some(t=>t.name===e),q=t=>{"Enter"===t.key&&t.currentTarget.blur()},S=(t,e)=>1===e.length?[t,e[0]]:[e.at(-2),e.at(-1)],E=t=>{const e=[t.querySelector("button").textContent];for(;t=t.parentNode?.closest("li");)e.unshift(t.querySelector("button").textContent);return e.join("/")},z=t=>{t.stopImmediatePropagation()},{at:C,map:L,reduce:$}=Array.prototype,{File:B}=globalThis,I=t=>{z(t);const{type:e}=t,s=t.target?.closest("li"),n=s?.querySelector("button");if(!s||n?.disabled||K)return;const i=J.get(s),r=j(s,"folder"),l="click"===e&&r?j(s,"opened")?"close":"open":e;return[s.closest(":host > ul").parentNode.host,s,n,r,v(e,{get owner(){const t=s.parentNode.closest("li");return t?J.get(t):s.closest(":host > ul").parentNode.host},originalTarget:s,path:E(s),action:l,folder:r,target:i})]},N=t=>{const e=t.querySelector("button").textContent.trim();if(j(t,"folder")){const s=new X(e);return s.append(...L.call(t.querySelector("ul").children,N)),s}return new V(["\0".repeat(+t.dataset.bytes||0)],e)},O=(t,e,s)=>{if(e instanceof X){const e=new X(s);return e.append(...t),e}return new V([e],s)},P=(t,e)=>t+1+(j(e,"folder")&&j(e,"opened")?M(e.querySelector("ul")):0),T=t=>{const{name:e,size:s,type:n}=t;let i=G.get(t);return i||(i=h("li",{className:/^text\//.test(n)?"text":"file"}),i.appendChild(h("button",{textContent:e,onfocus:U})).dataset.bytes=g(+s||0),G.set(t,i),J.set(i,t)),i},A=t=>(G.get(t).querySelector("button").focus(),t),M=({children:t})=>$.call(t,P,0),U=({currentTarget:t})=>{Q=J.get(t.closest("li"))},D=(t,e)=>{const s=t instanceof X,n=e instanceof X;return s&&!n?-1:!s&&n?1:t.name.localeCompare(e.name)},F=t=>{z(t),K=!1;for(const e of t.currentTarget.closest(":host > ul").querySelectorAll("ul"))e.style.height=j(e.parentElement,"opened")?"auto":"0px"},R=(t,e)=>{G.get(t).querySelector("button").dataset.items=`${e} item${1===e?"":"s"}`},W=CSS.supports("interpolate-size:allow-keywords"),H=await(async t=>{try{return(await import(t,{with:{type:"css"}})).default}catch{const e=new CSSStyleSheet;return await e.replace(await fetch(t).then(t=>t.text())),e}})(import.meta.url.replace(/(\.)?js(\+.+)?$/,"$1css")),G=new WeakMap,J=new WeakMap;let K=!1,Q=null;class V extends B{constructor(t,e,s){const n=(t=>{const e=t.lastIndexOf("."),s=t.slice(e);return{name:e<0?encodeURIComponent(t):encodeURIComponent(t.slice(0,e))+s,type:c[s]??"text/plain"}})(e);T(super([].concat(t),n.name,{type:n.type,...s}))}}class X{#t=[];#e;#s;constructor(t){this.#e=encodeURIComponent(t),this.#s=h("ul");const e=h("li",{className:"folder"});e.append(h("button",{textContent:t}),this.#s),G.set(this,e),J.set(e,this)}get files(){return this.items}get items(){return this.#t.slice(0)}get list(){return this.#s}get name(){return this.#e}get size(){return this.#t.reduce((t,e)=>t+e.size,0)}get type(){return"folder"}append(...t){const e=this.#t;for(let s of t){if("string"==typeof s)s=s.lastIndexOf(".")<0?new X(s):new V([],s);else if(!(s instanceof X))if(Symbol.iterator in s)this.append(...s);else if(s instanceof B)s instanceof V||(s=new V([s],s.name,s));else if("folder"===s.type){const t=s.items??s.files;s=new X(s.name),t&&s.append(...t)}else s=new V(s.content??[],s.name,s);e.includes(s)||e.push(s),this.#s.appendChild(T(s))}const{length:s}=e;R(this,s),e.sort(D);for(let{children:t}=this.#s,n=0;n<s;n++){const s=e[n],i=G.get(s);C.call(t,n)!==i&&this.#s.insertBefore(i,C.call(t,n))}return this}remove(...t){const e=this.#t;for(const s of t){Q===s&&(Q=null);const t=e.indexOf(s);t<0&&y(s,this),e.splice(t,1);const n=G.get(s);G.delete(s),J.delete(n),n.remove(),R(this,e.length)}return this}rename(t,e=""){const s=this.#t;if(s.includes(t)||y(t,this),e=e.trim()){k(s,e)&&w(e,this);const n=O(s,t,e);return this.remove(t).append(n),A(n)}{const n=G.get(t),i=n.querySelector("button"),r=()=>{n.classList.toggle("error",k(s,i.textContent.trim()))};return e=i.textContent.trim(),i.addEventListener("click",z),i.addEventListener("keydown",q),i.addEventListener("input",r),i.setAttribute("role","textbox"),i.contentEditable=!0,new Promise(n=>{i.addEventListener("blur",()=>{i.removeEventListener("click",z),i.removeEventListener("keydown",q),i.removeEventListener("input",r),i.removeAttribute("role"),i.contentEditable=!1;const l=i.textContent.trim();if(e===l)n(A(t));else{k(s,l)&&(i.textContent=e,w(l,this));const r=O(s,t,l);this.remove(t).append(r),n(A(r))}},{once:!0}),i.focus()})}}update(t,e){const s=this.#t,n=s.indexOf(t);return n<0&&y(t,this),s[n]=((t,e)=>{const s=G.get(t);return G.delete(t),G.set(e,s),J.set(s,e),s.querySelector("button").dataset.bytes=g(+e.size||0),e})(t,new V(e,t.name,t))}}class Y extends HTMLElement{#n;constructor(t={}){const e=super().querySelector("ul"),s=this.attachShadow({mode:"open"}),{list:n}=this.#n=new X("#root");if(s.adoptedStyleSheets.push(H),e){e.remove();for(const{name:t,value:s}of e.attributes)n.setAttribute(t,s);this.append(...L.call(e.children,N))}n.addEventListener("click",Z),n.addEventListener("contextmenu",_),s.replaceChildren(n)}get files(){return this.#n.files}get items(){return this.#n.items}get list(){return this.#n.list}get name(){return"#root"}get size(){return this.#n.size}get type(){return this.#n.type}get selected(){return Q}append(...t){let e,s=this.#n;if(2===t.length&&"string"==typeof t[0]){const[n,i]=t,r=n.split("/"),l=r.pop();for(const n of r)e=t.find(t=>t.name===n),e||(e=new X(n),s.append(e)),s=e;t=[new V(i,l)]}return s.append(...t),this}query(t){const e=[];let s,{items:n}=this;for(const i of t.split("/")){if(s=n.find(t=>t.name===i),!s)return null;s instanceof X&&({items:n}=s),e.push(s)}return e}remove(...t){let e,s=this.#n;if(1===t.length&&"string"==typeof t[0]){const n=this.query(t[0]);n||y({name:t[0]},this),[s,e]=S(s,n),t=[e]}return s.remove(...t),this}rename(t,e=""){let s=this.#n;if("string"==typeof t){const e=this.query(t);e||y({name:t},this),[s,t]=S(s,e)}return s.rename(t,e)}update(t,e){let s=this.#n;if("string"==typeof t){const e=this.query(t);e||y({name:t},this),[s,t]=S(s,e)}return s.update(t,e)}}async function Z(t){t.preventDefault();const e=I(t);if(!e)return;const[s,n,i,r,l]=e;if(s.dispatchEvent(l),!l.defaultPrevented){if(l.async){n.classList.add("waiting"),n.classList.remove("error");try{await l}catch{return void n.classList.add("error")}finally{n.classList.remove("waiting")}}if(r){if(!W){K=!0;const t=j(n,"opened"),e=n.querySelector("ul");e.addEventListener("transitionend",F),e.animate([{height:t?b(e):0},{height:t?0:parseFloat(b(n))*M(e)+"px"}],{iterations:1,duration:200,easing:"ease"})}n.classList.toggle("opened")}i!==document.activeElement&&i.focus()}}function _(t){const e=I(t);e&&e[0].dispatchEvent(u(e.pop(),{preventDefault:{value:()=>t.preventDefault()}}))}customElements.define("file-tree",Y);export{V as File,X as Folder,Y as Tree};
